(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/plus-cohort-25",headers:{authorization:"75517d06-b879-461d-b656-080fd61e6a64","Content-Type":"application/json"}};function t(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function n(e){return new Promise((function(t,n){var o=document.createElement("img");o.src=e,o.onerror=n,o.onload=t}))}var o=function(e){console.log(e)},c=function(e){"Escape"===e.key&&Array.from(document.querySelectorAll(".popup")).forEach((function(e){e.classList.contains("popup_opened")&&r(e)}))},r=function(e){var t;document.removeEventListener("keyup",c),t=e,Array.from(t.querySelectorAll(".form__input")).forEach((function(e){e.value=""})),e.classList.remove("popup_opened"),e.classList.add("popup_closed")},a=function(e){e.classList.remove("popup_closed"),e.classList.add("popup_opened"),document.addEventListener("keyup",c)};document.addEventListener("click",(function(e){return e.target.classList.contains("popup")?r(e.target):e.target.classList.contains("popup__view-image")||e.target.classList.contains("popup__button-close")?r(e.target.closest(".popup")):void 0}));var i=document.querySelector(".places"),u=document.querySelector("#card-template").content.querySelector(".places__place-card"),l=function(n){var c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=n._id,l=u.cloneNode(!0);l.querySelector(".places__place-title-text").textContent=n.name,l.querySelector(".places__place-image").style.backgroundImage="url(".concat(n.link,")");var s=l.querySelector(".places__place-delete");c?s.addEventListener("click",(function(){var t=s.closest(".places__place-card");!function(t,n){(function(t){return fetch("".concat(e.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:e.headers})})(t).then((function(){n.remove()})).catch((function(e){o("Ошибка deleteCard: ".concat(e))}))}(i,t)})):s.remove();var d=n.likes.length,f=l.querySelector(".places__place-like-count");f.textContent="".concat(d);var p=l.querySelector(".places__place-like");return r&&p.classList.add("places__place-like_active"),p.addEventListener("click",(function(){!function(n,c,r){c.classList.contains("places__place-like_active")?function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:e.headers}).then((function(e){return t(e)}))}(n).then((function(e){var t=e.likes.length;r.textContent=t,c.classList.toggle("places__place-like_active")})).catch((function(e){o("Ошибка deleteLikeCard: ".concat(e))})):function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:e.headers}).then((function(e){return t(e)}))}(n).then((function(e){var t=e.likes.length;r.textContent=t,c.classList.toggle("places__place-like_active")})).catch((function(e){o("Ошибка addLikeCard: ".concat(e))}))}(i,p,f)})),l.querySelector(".places__place-image").addEventListener("click",(function(){var e,t,o,c,r;e=n.name,t=n.link,c=(o=document.getElementById("popup_view_image")).querySelector(".popup__view-image"),r=o.querySelector(".popup__view-image-title"),c.src=t,c.alt=e,r.textContent=e,a(o)})),l};var s=function(e,t,n){var o=t.querySelector(".".concat(n.name,"-error"));n.classList.remove(e.inputErrorClass),o.classList.remove(e.errorClass),o.textContent=""},d=function(e,t,n){n.validity.valueMissing?n.setCustomValidity(n.dataset.errorEmpty):n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?s(e,t,n):function(e,t,n,o){var c=t.querySelector(".".concat(n.name,"-error"));n.classList.add(e.inputErrorClass),c.textContent=o,c.classList.add(e.errorClass)}(e,t,n,n.validationMessage)},f=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(n.disabled=!1,n.classList.remove(e.inactiveButtonClass)):(n.disabled=!0,n.classList.add(e.inactiveButtonClass))},p=function(e,t){var n=document.querySelector(".profile__name"),o=document.querySelector(".profile__subtitle");n.textContent=e,o.textContent=t},m=function(e){document.querySelector(".profile__image").src=e},v=function(c){var i=document.getElementById("popup_edit_profile").querySelector("form"),u=document.getElementById("popup_add_card"),v=u.querySelector("form"),_=document.querySelector(".profile__button-edit"),h=document.querySelector(".profile__button-add"),y=document.querySelector(".profile__name"),S=document.querySelector(".profile__subtitle"),b=document.getElementById("popup_avatar_edit"),E=b.querySelector("form"),g=document.querySelector(".profile__button-avatar-edit"),q=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){s(t,e,n)})),f(t,n,o)};_.addEventListener("click",(function(){q(i,c),function(e,t,n){e.username.value="".concat(t.textContent),e.aboutself.value="".concat(n.textContent),a(e.closest(".popup"))}(i,y,S),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(c){d(t,e,c),f(t,n,o)}))}(i,c)})),h.addEventListener("click",(function(){q(v,c),a(u)})),g.addEventListener("click",(function(){q(E,c),a(b)})),i.addEventListener("submit",(function(n){!function(n,c){n.preventDefault();var a,i,u=c.querySelector(".form__button");u.textContent="Сохранение...",(a="".concat(c.username.value),i="".concat(c.aboutself.value),fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:a,about:i})}).then((function(e){return t(e)}))).then((function(e){p(e.name,e.about),r(c.closest(".popup"))})).catch((function(e){o("Ошибка FormEditSubmit: ".concat(e))})).finally((function(){u.textContent="Сохранить"}))}(n,i)})),v.addEventListener("submit",(function(c){!function(c,a){c.preventDefault();var i=a.querySelector(".form__button"),u="".concat(a.titlecard.value),s="".concat(a.refcard.value);i.textContent="Сохранение...",n(s).then((function(){(function(n,c){var r,a;(r=n,a=c,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:r,link:a})}).then((function(e){return t(e)}))).then((function(e){var t;t=e,document.querySelector(".places").prepend(l(t))})).catch((function(e){o("Ошибка : ".concat(e))}))})(u,s),r(a.closest(".popup"))})).catch((function(e){o("Ошибка get img: ".concat(e))})).finally((function(){i.textContent="Сохранить"}))}(c,v)})),E.addEventListener("submit",(function(c){!function(c,a){c.preventDefault();var i=a.querySelector(".form__button"),u="".concat(a.refava.value);i.textContent="Сохранение...",n(u).then((function(){(function(n){var c;(c=n,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:c})}).then((function(e){return t(e)}))).then((function(e){m(e.avatar)})).catch((function(e){o("Ошибка: ".concat(e))}))})(u),r(a.closest(".popup"))})).catch((function(e){o("Ошибка загрузки изображения: ".concat(e))})).finally((function(){i.textContent="Сохранить"}))}(c,E)}))};window.onload=function(){var c={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_disable",inputErrorClass:"form__input_type_error",errorClass:"form__error_visible"};fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(e){return t(e)})).then((function(r){var a,u;p(r.name,r.about),n(a=r.avatar).then((function(){m(a)})).catch((function(e){o("Ошибка загрузки изображения: ".concat(e))})),u=r._id,fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then((function(e){return t(e)})).then((function(e){!function(e,t){e.forEach((function(e){var n=e.likes&&e.likes.some((function(e){return e._id===t})),o=t===e.owner._id;i.append(l(e,o,n))}))}(e,u)})).catch((function(e){o("Ошибка initCardsList: ".concat(e))})),v(c),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);f(e,n,o),n.forEach((function(c){c.addEventListener("input",(function(){d(e,t,c),f(e,n,o)}))}))}(e,t)}))}(c)})).catch((function(e){o("Ошибка: ".concat(e))}))}})();