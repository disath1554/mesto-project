(()=>{"use strict";var t="75517d06-b879-461d-b656-080fd61e6a64",e="https://nomoreparties.co/v1/plus-cohort-25";function n(t){return new Promise((function(e,n){var o=document.createElement("img");o.src=t,o.onerror=n,o.onload=e}))}var o=function(t){console.log(t)},c=function(t){"Escape"===t.key&&Array.from(document.querySelectorAll(".popup")).forEach((function(t){t.classList.contains("popup_opened")&&r(t)}))},r=function(t){var e;document.removeEventListener("keyup",c),e=t,Array.from(e.querySelectorAll(".form__input")).forEach((function(t){t.value=""})),t.classList.remove("popup_opened"),t.classList.add("popup_closed")},a=function(t){t.classList.remove("popup_closed"),t.classList.add("popup_opened"),document.addEventListener("keyup",c)};document.addEventListener("click",(function(t){return t.target.classList.contains("popup")?r(t.target):t.target.classList.contains("popup__view-image")||t.target.classList.contains("popup__button-close")?r(t.target.closest(".popup")):void 0}));var i=document.querySelector(".places"),u=document.querySelector("#card-template").content.querySelector(".places__place-card"),s=function(n){var c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=n._id,s=u.cloneNode(!0);s.querySelector(".places__place-title-text").textContent=n.name,s.querySelector(".places__place-image").style.backgroundImage="url(".concat(n.link,")");var l=s.querySelector(".places__place-delete");c?l.addEventListener("click",(function(){var n=l.closest(".places__place-card");!function(n,c){(function(n){return fetch("".concat(e,"/cards/").concat(n),{method:"DELETE",headers:{authorization:t}})})(n).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).then((function(t){c.remove()})).catch((function(t){o("Ошибка deleteCard: ".concat(t))}))}(i,n)})):l.style.visibility="hidden";var d=n.likes.length,f=s.querySelector(".places__place-like-count");f.textContent="".concat(d);var p=s.querySelector(".places__place-like");return r&&p.classList.add("places__place-like_active"),c||p.addEventListener("click",(function(){!function(n,c,r){var a=c.classList.contains("places__place-like_active");c.classList.toggle("places__place-like_active"),a?function(n){return fetch("".concat(e,"/cards/likes/").concat(n),{method:"DELETE",headers:{authorization:t}})}(n).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).then((function(t){var e=t.likes.length;r.textContent=e})).catch((function(t){o("Ошибка deleteLikeCard: ".concat(t))})):function(n){return fetch("".concat(e,"/cards/likes/").concat(n),{method:"PUT",headers:{authorization:t}})}(n).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).then((function(t){var e=t.likes.length;r.textContent=e})).catch((function(t){o("Ошибка addLikeCard: ".concat(t))}))}(i,p,f)})),s.querySelector(".places__place-image").addEventListener("click",(function(){var t,e,o,c,r;t=n.name,e=n.link,c=(o=document.getElementById("popup_view_image")).querySelector(".popup__view-image"),r=o.querySelector(".popup__view-image-title"),c.src=e,c.alt=t,r.textContent=t,a(o)})),s};var l=function(t,e,n){var o=e.querySelector(".".concat(n.name,"-error"));n.classList.remove(t.inputErrorClass),o.classList.remove(t.errorClass),o.textContent=""},d=function(t,e,n){n.validity.valueMissing?n.setCustomValidity(n.dataset.errorEmpty):n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?l(t,e,n):function(t,e,n,o){var c=e.querySelector(".".concat(n.name,"-error"));n.classList.add(t.inputErrorClass),c.textContent=o,c.classList.add(t.errorClass)}(t,e,n,n.validationMessage)},f=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(e)?(n.disabled=!1,n.classList.remove(t.inactiveButtonClass)):(n.disabled=!0,n.classList.add(t.inactiveButtonClass))},p=function(t,e){var n=document.querySelector(".profile__name"),o=document.querySelector(".profile__subtitle");n.textContent=t,o.textContent=e},m=function(t){document.querySelector(".profile__image").src=t},v=function(c){var i=document.getElementById("popup_edit_profile").querySelector("form"),u=document.getElementById("popup_add_card"),v=u.querySelector("form"),_=document.querySelector(".profile__button-edit"),h=document.querySelector(".profile__button-add"),y=document.querySelector(".profile__name"),S=document.querySelector(".profile__subtitle"),C=document.getElementById("popup_avatar_edit"),E=C.querySelector("form"),q=document.querySelector(".profile__button-avatar-edit"),b=function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);n.forEach((function(n){l(e,t,n)})),f(e,n,o)};_.addEventListener("click",(function(){b(i,c),function(t,e,n){t.username.value="".concat(e.textContent),t.aboutself.value="".concat(n.textContent),a(t.closest(".popup"))}(i,y,S),function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);n.forEach((function(c){d(e,t,c),f(e,n,o)}))}(i,c)})),h.addEventListener("click",(function(){b(v,c),a(u)})),q.addEventListener("click",(function(){b(E,c),a(C)})),i.addEventListener("submit",(function(n){!function(n,c){n.preventDefault();var a,i,u=c.querySelector(".form__button");u.textContent="Сохранение...",(a="".concat(c.username.value),i="".concat(c.aboutself.value),fetch("".concat(e,"/users/me"),{method:"PATCH",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({name:a,about:i})})).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).then((function(t){p(t.name,t.about)})).catch((function(t){o("Ошибка FormEditSubmit: ".concat(t))})).finally((function(){c.reset(),u.textContent="Сохранить",r(c.closest(".popup"))}))}(n,i)})),v.addEventListener("submit",(function(c){!function(c,a){c.preventDefault();var i=a.querySelector(".form__button"),u="".concat(a.titlecard.value),l="".concat(a.refcard.value);i.textContent="Сохранение...",n(l).then((function(){!function(n,c){var r,a;(r=n,a=c,fetch("".concat(e,"/cards"),{method:"POST",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({name:r,link:a})})).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).then((function(t){var e;e=t,document.querySelector(".places").prepend(s(e))})).catch((function(t){o("Ошибка : ".concat(t))}))}(u,l)})).catch((function(t){o("Ошибка get img: ".concat(t))})).finally((function(){i.textContent="Сохранить",a.reset(),r(a.closest(".popup"))}))}(c,v)})),E.addEventListener("submit",(function(c){!function(c,a){c.preventDefault();var i=a.querySelector(".form__button"),u="".concat(a.refava.value);i.textContent="Сохранение...",n(u).then((function(){!function(n,c){var r;(r=c,fetch("".concat(e,"/users/me/avatar"),{method:"PATCH",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({avatar:r})})).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).then((function(t){m(t.avatar)})).catch((function(t){o("Ошибка: ".concat(t))}))}(0,u)})).catch((function(t){o("Ошибка загрузки изображения: ".concat(t))})).finally((function(){a.reset(),i.textContent="Сохранить",r(a.closest(".popup"))}))}(c,E)}))};window.onload=function(){var c={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_disable",inputErrorClass:"form__input_type_error",errorClass:"form__error_visible"};fetch("".concat(e,"/users/me"),{headers:{authorization:t}}).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).then((function(r){var a,u;p(r.name,r.about),n(a=r.avatar).then((function(){m(a)})).catch((function(t){o("Ошибка загрузки изображения: ".concat(t))})),u=r._id,fetch("".concat(e,"/cards"),{headers:{authorization:t}}).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).then((function(t){!function(t,e){t.forEach((function(t){var n=t.likes&&t.likes.some((function(t){return t._id===e})),o=e===t.owner._id;i.append(s(t,o,n))}))}(t,u)})).catch((function(t){o("Ошибка initCardsList: ".concat(t))})),v(c),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);f(t,n,o),n.forEach((function(c){c.addEventListener("input",(function(){d(t,e,c),f(t,n,o)}))}))}(t,e)}))}(c)})).catch((function(t){o("Ошибка: ".concat(t))}))}})();